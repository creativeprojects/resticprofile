
# -----------------------------------------------------------------------------
# Resticprofile backup profiles for "restic" backups
# See https://github.com/creativeprojects/resticprofile
#
# Note: This configuration file should not be changed directly.
#       Add overrides to "conf.d" and profiles to "profiles.d".
# -----------------------------------------------------------------------------

##
# Loading config overrides from "conf.d" and profiles from "profiles.d":
includes = [
  'conf.d/*.conf',
  'profiles.d/*.toml',
  'profiles.d/*.yaml',
]


##
# The global section
[global]
# initialize a repository if none exists at the specified location
# (can be overriden in individual profiles)
initialize = false

# restic IO priority
ionice = false
#ionice-class = 2
#ionice-level = 6

# restic CPU-priority ( idle | background | low | normal | high )
priority = "low"

# scheduler to use: "systemd" (default) or "crond"
#scheduler = "systemd"

# systemd unit & timer template
systemd-unit-template = "templates/systemd.unit.in"
systemd-timer-template = "templates/systemd.timer.in"

# what to run when no command is specified
default-command = "snapshots"

# Optional: Specify path to restic
#restic-binary = "/usr/local/bin/restic"


##
# The "default" profile
#
# This profile is choosen when no profile is explicitly specified and
# is configured to support commands on the default repository like
# "snapshots", "check", "prune" & "mount".
#
# It is also the parent to the "base" profile which means that profiles
# inheriting from "base" also inherit all settings from "default"
#
# The default profile should not be used directly for running backups
# nor should it contain schedules.
[default]
## Locks
# Prevent concurrent invocation of a profile
lock = "{{.TempDir}}/resticprofile-{{.Profile.Name}}.lock"
# Detect stale locks and unlock automatically
force-inactive-lock = true


##
# Backup defaults
[default.backup]

# Hostname and tags to identify backup snapshots in the repository
#### {{block "conf:default-backup-tags" .}}
# Multiple tags can be used, defaulting to profile name.
# Important: Set the same tags for "backup" and "retention"
tag = [ "{{.Profile.Name}}" ]
#### {{end}}
#### {{block "conf:default-backup-host" .}}
# Specify a hostname or leave it at 'true' for the current hostname
host = true
#### {{end}}

# Exclude known cache files & folders from backups
exclude-caches = true

# Exclude nested filesystems
one-file-system = true

# Toggle whether a failure in reading a backup source is considered an error
#no-error-on-warning = false

# Wait on acquiring locks when running the profile on a schedule
schedule-lock-wait = "30m"

# Specify the user that runs profile tasks on a schedule
# "system" - root runs the profile tasks
# "user" - user that created the schedule runs the profile tasks
schedule-permission = "system"

# Toggle verbose output for troubleshooting
#verbose = false


##
# Snapshot retention defaults
[default.retention]
# Remove obsolete snapshots prior to starting a backup
before-backup = false
# Remove obsolete snapshots after a successful backup
after-backup = true

# Copying "host" and "tags" blocks to identify snapshots to retain or remove
# Note: "host" and "tag" must be in sync between "backup" and "retention"
{{template "conf:default-backup-host" .}}
# In retention, tags can be copied from backup with `true`:
tags = true

# Copying backup source paths to identify snapshots to retain or remove
# Set to "false" or a list of paths to disable or customize the path filter
path = true

# Specify the snapshots to keep when checking for obsolete snapshots
# Snapshots that do not match any condition are removed
keep-tag = [ "forever" ]
keep-last = 3
#keep-hourly = 1
#keep-daily = 1
#keep-weekly = 1
#keep-monthly = 1
#keep-yearly = 1
#keep-within = "30d"

# Use compact format for listing snapshots
#compact = false

# Enable to prune the repository immediatelly as snapshots are removed
# Prune can be expensive. Consider scheduling prune (see "conf.d/prune.conf")
#prune = true


##
# Defaults for showing snapshots of this host
# Usage:
# - `resticprofile snapshots` to view snapshots of this host
[default.snapshots]
# Copying "host" block to identify snapshots to list
{{template "conf:default-backup-host" .}}


##
# Defaults for mounting snapshot of this host
# Usage:
# - `resticprofile mount /mnt/restore` to mount snapshots of this host
[default.mount]
# Copying "host" block to identify snapshots to mount
{{template "conf:default-backup-host" .}}



##
# The "base" profile is the base for all other profiles to inherit from
#
# Note: Profiles that do not inherit from "base" will run on built-in
#       defaults instead and have to take care of a full profile setup.
[base]
# Inherit all settings from the "default" profile
inherit = "default"


##
# Configures the "snapshots" command for profiles inheriting from "base"
# Usage:
# - `resticprofile -n profileName snapshots` to view snapshots of one profile
[base.snapshots]
# Copying "host" and "tags" blocks to identify snapshots to list
{{template "conf:default-backup-host" .}}
{{template "conf:default-backup-tags" .}}


##
# Configures the "mount" command for profiles inheriting from "base"
# Usage:
# - `resticprofile -n profileName mount /mnt/restore` to mount snapshots
[base.mount]
# Copying "host" and "tags" block to identify snapshots to mount
{{template "conf:default-backup-host" .}}
{{template "conf:default-backup-tags" .}}
